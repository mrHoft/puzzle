var ae=Object.defineProperty;var le=(n,t,e)=>t in n?ae(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var a=(n,t,e)=>(le(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();class ce{constructor(t,e){a(this,"_pathname");a(this,"_page");a(this,"_block");this._pathname=t,this._page=e,this._block=!1}get pathname(){return this._pathname}navigate(t){this.match(t)&&(this._pathname=t,this.render())}leave(){this._block}match(t){return t==this._pathname}render(){this._block=!0,this._page()}}const v=class v{constructor(t){a(this,"history",window.history);a(this,"routes",[]);a(this,"_currentRoute",null);a(this,"_rootQuery","/");if(v._instance)return v._instance;this._rootQuery=t??window.location.pathname,v._instance=this}use(t,e){const s=new ce(t,e);return this.routes.push(s),this}start(){window.onpopstate=()=>{this._onRoute(window.location.pathname)},this._onRoute(window.location.pathname)}_onRoute(t){const e=t.substring(t.lastIndexOf("/"));let s=this.getRoute(e);s||(s=this.getRoute("/404")),s&&(this._currentRoute&&this._currentRoute.leave(),this._currentRoute=s,s.render())}go(t){this.history.pushState({route:t},"",`${this._rootQuery}${t}`.replace("//","/")),this._onRoute(t)}back(){this.history.back()}forward(){this.history.forward()}getRoute(t){return t?this.routes.find(e=>e.match(t))||null:this._currentRoute}};a(v,"_instance");let H=v;const g=new H,G=n=>Object.keys(n);function w(n,t=document){const e=t.querySelector(n);if(e)return e;throw new Error(`${n} was not found in ${t instanceof Document?"document":t.tagName}`)}function r(n,t){const e=document.createElement(n);return G(t).forEach(s=>{const i=t[s];if(i!=null)switch(s){case"name":{n==="select"&&(e.name=i),n==="input"&&(e.name=i);break}case"src":{n==="img"&&(e.src=i);break}case"href":{n==="a"&&(e.href=i);break}case"onClick":{e.onclick=t.onClick;break}default:Object.assign(e,{[s]:i})}}),e}const m=class m{constructor(){a(this,"_state",{});if(m._instance)return m._instance;const t=localStorage.getItem(m.STORE_NAME);t&&(this._state=JSON.parse(t)),m._instance=this}getState(){return this._state}removeState(){this._state={},this.emit()}get(t){return he(this._state,t)}set(t,e){de(this._state,t,e),this.emit()}emit(){localStorage.setItem(m.STORE_NAME,JSON.stringify(this._state))}};a(m,"STORE_NAME","PuzzleStore"),a(m,"_instance");let I=m;function de(n,t,e){if(n!==Object(n))return n;if(typeof t!="string"||t==="")throw new Error("App store. Path must be type of string.");let s=n;const i=t.split("."),o=i.pop();return i.forEach(l=>{s[l]||(s[l]={}),s=s[l]}),o&&(s[o]=e),n}function he(n,t){if(n!==Object(n)||typeof t!="string"||t==="")throw new Error(`App store. Wrong path: ${t}`);return t.split(".").reduce((e,s)=>e&&e[s]!==void 0?e[s]:void 0,n)}const _=new I;function M(){const n=_.get("user");return n&&Object.prototype.hasOwnProperty.call(n,"name")&&Object.prototype.hasOwnProperty.call(n,"surname")?n:null}function ue(n){if(!n||!Object.prototype.hasOwnProperty.call(n,"name")||!Object.prototype.hasOwnProperty.call(n,"surname"))throw new Error("User data is incorrect.");_.set("user",n)}function me(){_.set("user",void 0)}const ge=()=>typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",_e=ge()==="dark",Y=["sound","picture","translation"],pe={sound:!0,picture:!0,translation:!0,dark:_e};function C(){const n=_.get("settings");return n&&Y.every(t=>Object.prototype.hasOwnProperty.call(n,t))?n:{...pe}}function fe(n){if(!n||Y.some(t=>!Object.prototype.hasOwnProperty.call(n,t)))throw new Error("Settings data is incorrect.");_.set("settings",n)}function ve(){_.set("settings",void 0)}const Z=["level","round"],we={level:0,round:-1,level_completed:"",round_completed:""};function be(){const n=_.get("progress");return n&&Z.every(t=>Object.prototype.hasOwnProperty.call(n,t))?n:{...we}}function Ce(n){if(!n||Z.some(t=>!Object.prototype.hasOwnProperty.call(n,t)))throw new Error("Progress data is incorrect.");_.set("progress",n)}function ye(){_.set("progress",void 0)}const Le="./assets/login.svg",ze="./assets/logout.svg";function ke({name:n,surname:t}){return`${(n??"").charAt(0)}${(t??"").charAt(0)}`}function xe(){me(),ve(),ye(),F(),g.go("/")}const F=()=>{const n=M(),t=document.getElementById("user")??r("div",{className:"user__menu",id:"user"});t.onclick=n?xe:()=>g.go("/login"),t.innerHTML="";const e=r("img",{className:n?"user__menu_icon opaque":"user__menu_icon",src:n?ze:Le});return t.append(e),n&&t.append(ke(n)),t};class Ne{constructor(){a(this,"_game",{level:0,page:0,line:0,skipped:[],fullfilled:!1,passed:!1,rounds:0,image:""});a(this,"_sentence",[]);a(this,"_items",[]);a(this,"elements",{levelSelect:null,pageSelect:null,puzzleBody:null,imageInfo:null,sourceText:null,sourceBlock:null,autoComplete:null});a(this,"rows",[]);a(this,"marks",[])}get game(){return this._game}get sentence(){return this._sentence}get items(){return this._items}set items(t){this._items=t}get levelSelect(){if(!this.elements.levelSelect)throw new Error("No levelSelect element");return this.elements.levelSelect}get pageSelect(){if(!this.elements.pageSelect)throw new Error("No pageSelect element");return this.elements.pageSelect}get puzzleBody(){if(!this.elements.puzzleBody)throw new Error("No puzzleBody element");return this.elements.puzzleBody}get imageInfo(){if(!this.elements.imageInfo)throw new Error("No imageInfo element");return this.elements.imageInfo}get sourceText(){if(!this.elements.sourceText)throw new Error("No sourceText element");return this.elements.sourceText}get sourceBlock(){if(!this.elements.sourceBlock)throw new Error("No sourceBlock element");return this.elements.sourceBlock}get autoComplete(){if(!this.elements.autoComplete)throw new Error("No autoComplete element");return this.elements.autoComplete}}const Ee="_speech__btn_1oie2_1",Se="_speech__btn_icon_1oie2_19",$e="_speech__btn_active_1oie2_27",Be="_spin_1oie2_1",R={speech__btn:Ee,speech__btn_icon:Se,speech__btn_active:$e,spin:Be},Oe="./assets/sound.svg",Pe="./assets/loading.svg";class ee{constructor(t){a(this,"_el");a(this,"_status");a(this,"_audio",null);a(this,"clickHandler",()=>{this._audio&&this._audio.play()});a(this,"getSpeechButton",()=>{const t=r("div",{className:R.speech__btn,onClick:this.clickHandler}),e=r("img",{className:`${R.speech__btn_active} hidden`,src:Pe}),s=r("img",{className:R.speech__btn_icon,src:Oe});return t.append(e,s),[t,e]});const[e,s]=this.getSpeechButton();this._el=e,this._status=s,t&&(this.audio=t)}get el(){return this._el}set audio(t){this._audio=new Audio(t),this._audio.addEventListener("play",()=>{this._status.classList.remove("hidden")}),this._audio.addEventListener("ended",()=>{this._status.classList.add("hidden")})}}const y=new ee;class Re extends Ne{constructor(){super(...arguments);a(this,"_settings",{picture:!0,sound:!0,translation:!0,dark:!0});a(this,"_progress",{level:0,round:-1,level_completed:"",round_completed:""})}get opt(){return this._settings}get progress(){return this._progress}roundCompleted(e){return this._progress.round_completed.split(",").filter(s=>Number(s.charAt(0))===e).map(s=>Number(s.split("_")[1]))}levelCompleted(){return this._progress.level_completed.split(",").filter(e=>e!=="").map(e=>Number(e))}refreshSettings(){this._settings=C(),this._progress=be()}setSetting(e,s){switch(this._settings[e]=s,e){case"translation":{this.sourceText&&this.sourceText.classList.toggle("hidden",!s);break}case"sound":{y.el.classList.toggle("hidden",!s);break}case"picture":{w(":root").style.setProperty("--puzzle-hint-img",s?`url(${this.game.image})`:"unset");break}default:return}}setProgress(e,s){this._progress.level=e,this._progress.round=s;const i=`${e}_${s}`,o=this._progress.round_completed.split(",");o.includes(i)||(o.push(i),this._progress.round_completed=o.join(",")),Ce(this._progress)}}function te(n){const t=w(".puzzle__body").getBoundingClientRect(),{width:e,height:s,top:i,left:o}=n.getBoundingClientRect(),l=n.firstElementChild,d=n.lastElementChild;n.style.width=`${e.toFixed(2)}px`,n.style.height=`${s.toFixed(2)}px`,l.style.backgroundPosition=`-${o-t.left}px -${i-t.top}px`,d.style.backgroundPosition=`-${o-t.left+e-8.5}px -${i-t.top+16}px`,n.classList.remove("grow"),n.classList.add("opaque")}class Te{constructor(t){a(this,"textContent");a(this,"_el");this.textContent=t,this._el=this.create()}get el(){return this._el}create(){const t=r("div",{className:"puzzle__item grow",draggable:!0}),e=r("div",{}),s=r("div",{});t.append(e,this.textContent,s);const i=new MutationObserver(()=>{document.contains(t)&&(te(t),i.disconnect())});return i.observe(document,{attributes:!1,childList:!0,characterData:!1,subtree:!0}),t}}class De{constructor(){a(this,"_el");a(this,"_state","check");this._el=this.init()}get el(){return this._el}get state(){return this._state}set state(t){t==="hidden"&&this._el.classList.add("hidden"),t==="check"&&(this._el.textContent="Check",this._el.classList.remove("hidden","ready","fail")),t==="ready"&&(this._el.textContent="Continue",this._el.classList.remove("hidden","fail"),this._el.classList.add("ready")),t==="fail"&&(this._el.classList.remove("hidden","ready"),this._el.classList.add("fail"))}init(){return r("div",{className:"puzzle__source_btn hidden",textContent:"Check"})}}const f=new De;class He{constructor(){a(this,"_el");a(this,"_state","hidden");this._el=this.init()}get el(){return this._el}get state(){return this._state}set state(t){t==="hidden"&&this._el.classList.add("hidden"),t==="ready"&&(this._el.classList.remove("hidden"),this._el.classList.add("results"))}init(){return r("div",{className:"puzzle__source_btn hidden",textContent:"Results"})}}const B=new He;class Ie extends Re{setOptions(t,e,s=0){t.innerHTML="",e.forEach((i,o)=>{const l=new Option(`${(o+1).toString()}${i?" ✔":""}`,o.toString(),!1,s===o);l.className=`puzzle__select_option${i?" done":""}`,t.append(l)})}setRow(t,e){const s=e.split(" ");this.rows[t].innerHTML="",s.forEach((i,o)=>{const l=new Te(i).el;o===0?l.classList.add("first"):o===s.length-1?l.classList.add("last"):l.classList.add("mid"),this.rows[t].append(l)})}drawField(){const t=r("div",{className:"puzzle"});return t.append(this.createSelectors(),this.createPuzzleBody(),this.createImageInfo(),this.createSourceBlock()),t}createSelectors(){const t=r("label",{className:"puzzle__level_label",textContent:"Level "});this.elements.levelSelect=r("select",{className:"puzzle__level",name:"level"}),t.appendChild(this.elements.levelSelect);const e=r("label",{className:"puzzle__page_label",textContent:"Page "});this.elements.pageSelect=r("select",{className:"puzzle__page",name:"page"}),e.appendChild(this.elements.pageSelect);const s=r("div",{className:"puzzle__select"});return s.append(t,e),s}createPuzzleBody(){this.elements.puzzleBody=r("div",{className:"puzzle__body"});for(let t=1;t<=10;t+=1){const e=r("div",{className:`puzzle__row row_${t}`});this.rows[t]=e;const s=r("div",{className:"puzzle__row_mark",textContent:t.toString()});this.marks[t]=s,this.elements.puzzleBody.append(s,e)}return this.elements.puzzleBody}createImageInfo(){return this.elements.imageInfo=r("div",{className:"puzzle__image_info hidden"}),this.elements.imageInfo}createSourceBlock(){const t=r("div",{className:"puzzle__source_container"}),e=r("div",{className:"puzzle__hints"});this.elements.sourceText=r("p",{className:"puzzle__source_text"}),e.append(y.el,this.sourceText),this.elements.sourceBlock=r("div",{className:"puzzle__source"}),this.elements.autoComplete=r("div",{className:"puzzle__source_auto",textContent:"Auto-Complete"});const s=r("div",{});return s.append(f.el,B.el),t.append(e,this.sourceBlock,this.autoComplete,s),t}}class Ae{constructor(){a(this,"round",[])}}const Me=n=>`./data/wordCollectionLevel${n+1}.json`;class Fe extends Ae{constructor(){super(...arguments);a(this,"_state",{level:0,page:0})}get(){const{level:e,page:s}=this._state;return new Promise(i=>{if(this.round[e]){const o=this.round[e].length;if(s>=o){i(this.round[e][o-1]);return}i(this.round[e][s])}else fetch(Me(e),{method:"GET",headers:{Accept:"application/json"}}).then(o=>o.json()).then(o=>{if(o&&Object.prototype.hasOwnProperty.call(o,"rounds")){const{rounds:d}=o;this.round[e]=d}const l=this.round[e].length;if(s>=l){i(this.round[e][l-1]);return}i(this.round[e][s])})})}change({level:e,page:s},i){e!==void 0&&e!=this._state.level&&(s=0),this._state={level:e!==void 0?e:this._state.level,page:s!==void 0?s:this._state.page},this.get().then(()=>{i&&i.forEach(o=>o())})}}const p=new Fe;function je(n){const t=Array.from(n);let e=t.length,s=0;for(;e>0;)s=Math.floor(Math.random()*e),e-=1,[t[e],t[s]]=[t[s],t[e]];return t}const qe="_modal__wrapper_1vl4r_1",Ue="_reveal_1vl4r_1",We="_modal__outer_1vl4r_26",Qe="_modal__inner_1vl4r_38",Ve="_modal__close_1vl4r_45",L={modal__wrapper:qe,reveal:Ue,modal__outer:We,modal__inner:Qe,modal__close:Ve},Je="./assets/close.svg";class Ke{constructor(){a(this,"_el");a(this,"_inner");a(this,"close",()=>{this._el.classList.add("hidden")});a(this,"handleClick",t=>{const{target:e,currentTarget:s}=t;e===s&&(t.preventDefault(),this.close())});a(this,"init",()=>{const t=r("div",{className:`${L.modal__wrapper} hidden`,onClick:this.handleClick}),e=r("div",{className:L.modal__outer}),s=r("div",{className:L.modal__close,onClick:this.close}),i=r("img",{src:Je});s.append(i);const o=r("div",{className:L.modal__inner});return e.append(s,o),t.append(e),{modal:t,inner:o}});const{modal:t,inner:e}=this.init();this._el=t,this._inner=e}get el(){return this._el}show(t){this._el.classList.remove("hidden"),this._inner.innerHTML="",this._inner.append(t)}}const A=new Ke,W=(n,t)=>{const e=document.createDocumentFragment(),s=r("p",{className:"results__words_title",textContent:n}),i=r("ul",{className:"results__words_list"});return i.append(...t.map(o=>{const l=r("li",{className:"results__words_item"});return l.append(new ee(o.sound).el,o.sentence),l})),e.append(s,i),e},Xe=({level:n,round:t,src:e,name:s,year:i,words:o,skipped:l,onClick:d})=>{const c=document.createDocumentFragment(),u=r("h2",{className:"results__title",textContent:"Page completed!"}),O=r("p",{className:"results__level",textContent:`Level: ${n+1}. Page: ${t+1}.`}),h=r("img",{className:"results__thumb",src:e,alt:"thumbnail"}),b=r("p",{className:"results__descr",textContent:`${s} (${i})`}),q=r("div",{className:"results__words scrolled"}),U=o.filter((re,P)=>!l.includes(P));q.append(W(`Solution used (${l.length}):`,o.filter((re,P)=>l.includes(P))),W(`Solved (${U.length}):`,U));const oe=r("button",{className:"button",textContent:"Continue",onClick:()=>{d(),A.close()}});c.append(u,O,h,b,q,oe),A.show(c)},Q={drop:"./assets/drop.mp3",match:"./assets/match.mp3",tada:"./assets/tada.mp3"};class Ge{constructor(){a(this,"_audio");this._audio=G(Q).reduce((t,e)=>(t[e]=new Audio(Q[e]),t),{})}play(t){var e;(e=this._audio[t])==null||e.play()}}const z=new Ge,Ye="_message__wrapper_1tezc_1",Ze="_message__icon_1tezc_28",T={message__wrapper:Ye,"slide-down":"_slide-down_1tezc_1",message__icon:Ze};class et{constructor(){a(this,"_el");a(this,"_text");a(this,"_timer",null);a(this,"init",()=>{const t=r("div",{className:`${T.message__wrapper} hidden`}),e=r("div",{className:T.message__icon,textContent:"✔"}),s=r("div",{className:T.message__text});return t.append(e,s),{message:t,text:s}});const{message:t,text:e}=this.init();this._el=t,this._text=e}get el(){return this._el}show(t){this._el.classList.remove("hidden"),this._text.textContent=t,this._timer&&(clearTimeout(this._timer),this._timer=null),this._timer=setTimeout(()=>this._el.classList.add("hidden"),3e3)}}const j=new et,k="https://raw.githubusercontent.com/rolling-scopes-school/rss-puzzle-data/main/";class tt extends Ie{constructor(){super();a(this,"_drag",{item:null,over:null,neigh:null});a(this,"_field",{size:0});a(this,"isInitialized",!1);a(this,"levelChangeCallback",()=>{const e=p.round[this.game.level].length;this.game.rounds=e;const s=this.roundCompleted(this.game.level),i=Array.from({length:e},(d,c)=>s.includes(c));this.setOptions(this.pageSelect,i,this.game.page);const o=this.levelCompleted(),l=Array.from({length:6},(d,c)=>o.includes(c));this.setOptions(this.levelSelect,l,this.game.level)});a(this,"lineChangeCallback",()=>setTimeout(()=>this.setSource(),100));a(this,"showResults",()=>{p.get().then(e=>{Xe({level:this.game.level,round:this.game.page,src:`${k}images/${e.levelData.imageSrc}`,name:e.levelData.name,year:e.levelData.year,words:e.words.map(s=>({sentence:s.textExample,sound:`${k}${s.audioExample}`})),skipped:this.game.skipped,onClick:this.continueHandler.bind(this)})})});a(this,"continueHandler",()=>{if(this.game.passed){if(this.lineComplete(),this.game.passed=!1,this.game.line+=1,this.game.line<=10){this.setSource();return}this.nextRound()}else{const e=this.sentenceCheck();f.state=e?"ready":"fail",e&&(this.sourceText.classList.remove("hidden"),y.el.classList.remove("hidden"),this.game.line===10&&this.pageComplete())}});a(this,"resizeHandler",()=>{var s;if(((s=g.getRoute())==null?void 0:s.pathname)!=="/game")return;const e=Math.floor(this.puzzleBody.getBoundingClientRect().width);if(e!==this._field.size){this._field.size=e;const i=w(":root"),{width:o,height:l}=this.puzzleBody.getBoundingClientRect();i.style.setProperty("--puzzle-size",`${o}px ${l}px`);const{height:d}=this.rows[1].getBoundingClientRect();this.rows.forEach((c,u)=>c.style.backgroundPosition=`0px -${d*(u-1)}px`),this.items.forEach(c=>{this.rows[this.game.line].appendChild(c)});for(let c=1;c<11;c+=1){const u=this.rows[c].children;Array.from({length:u.length},(h,b)=>u[b]).forEach(h=>{h.removeAttribute("style"),h.classList.add("grow"),h.classList.add("opaque")})}for(let c=1;c<11;c+=1){const u=this.rows[c].children;Array.from({length:u.length},(h,b)=>u[b]).forEach(h=>{te(h),c<=this.game.line&&h.classList.remove("opaque")})}this.items.forEach(c=>{this.sourceBlock.appendChild(c),delete c.dataset.placed})}});this.baseChangeCallback=this.baseChangeCallback.bind(this),this.dragEnter=this.dragEnter.bind(this),this.dragOver=this.dragOver.bind(this),this.dropCard=this.dropCard.bind(this)}baseChangeCallback(){this.game.line=1,this.game.skipped=[],this.game.passed=!1,f.state="hidden",B.state="hidden";const e=w(":root");p.get().then(s=>{this.game.image=`${k}images/${s.levelData.imageSrc}`,e.style.setProperty("--puzzle-img",`url(${this.game.image})`),this.opt.picture&&e.style.setProperty("--puzzle-hint-img",`url(${this.game.image})`);const{width:i,height:o}=this.puzzleBody.getBoundingClientRect();e.style.setProperty("--puzzle-size",`${i}px ${o}px`);const{height:l}=this.rows[1].getBoundingClientRect();this.rows.forEach((d,c)=>{d.classList.remove("complete"),this.removeDragReceiveListeners(d),d.style.backgroundPosition=`0px -${l*(c-1)}px`}),this.marks.forEach(d=>d.classList.remove("complete")),this.imageInfo.textContent=`${s.levelData.name} (${s.levelData.year})`,this.imageInfo.classList.add("hidden"),s.words.forEach((d,c)=>{this.setRow(c+1,d.textExample),this.sentence[c]=d.textExample})})}nextRound(){this.setProgress(this.game.level,this.game.page),this.game.page+=1;const e=[this.baseChangeCallback,this.levelChangeCallback,this.lineChangeCallback];if(this.game.page>=this.game.rounds){this.game.page=0,this.game.level+=1,this.game.level>5&&(this.game.level=0),p.change({level:this.game.level},e);return}p.change({page:this.game.page},e)}changeHandler(e){const s=e.target,i=s.name,o=Number(s.value),l=[this.baseChangeCallback,this.lineChangeCallback];(i==="level"||i==="page")&&(this.game[i]=o),i==="level"&&(this.game.page=0,l.push(this.levelChangeCallback)),p.change({[i]:o},l)}lineComplete(){Array.from(this.rows[this.game.line].children).forEach(e=>e.classList.remove("active")),this.removeDragReceiveListeners(this.rows[this.game.line]),this.rows[this.game.line].classList.add("complete"),this.marks[this.game.line].classList.add("complete")}pageComplete(){this.imageInfo.classList.remove("hidden"),this.lineComplete(),this.opt.sound&&z.play("tada"),B.state="ready"}sentenceCheck(){const s=Array.from(this.rows[this.game.line].children).reduce((i,o)=>`${i} ${o.textContent}`,"").trim();return this.game.passed=this.sentence[this.game.line-1]===s,this.game.passed&&this.opt.sound&&z.play("match"),this.game.passed}checkSource(){this.sourceBlock.children.length?this.game.fullfilled&&(this.game.fullfilled=!1,this.sourceBlock.classList.remove("hidden"),this.autoComplete.classList.remove("hidden"),f.state="hidden",this.game.passed=!1):(this.game.fullfilled=!0,this.sourceBlock.classList.add("hidden"),this.autoComplete.classList.add("hidden"),f.state="check")}setSource(){p.get().then(i=>{this.sourceText.textContent=i.words[this.game.line-1].textExampleTranslate,this.sourceText.classList.toggle("hidden",!this.opt.translation),y.audio=`${k}${i.words[this.game.line-1].audioExample}`}),y.el.classList.toggle("hidden",!this.opt.sound),this.sourceBlock.classList.remove("hidden"),this.autoComplete.classList.remove("hidden"),f.state="hidden";const e=i=>{const o=i.currentTarget;o.dataset.placed?(this.sourceBlock.appendChild(o),delete o.dataset.placed):(this.rows[this.game.line].appendChild(o),o.dataset.placed="true"),this.opt.sound&&z.play("drop"),this.checkSource()};this.setDragReceiveListeners(this.rows[this.game.line]),this.sourceBlock.innerHTML="",this.items=Array.from({length:this.rows[this.game.line].children.length},(i,o)=>this.rows[this.game.line].children[o]),je(this.items).forEach(i=>{this.sourceBlock.appendChild(i),i.classList.remove("opaque"),i.classList.add("active"),i.addEventListener("click",e),i.addEventListener("dragstart",this.dragStart.bind(this)),i.addEventListener("dragend",this.dragEnd.bind(this)),i.addEventListener("dragover",this.dragOverItem.bind(this))})}autoCompleteHandler(){Array.from(this.rows[this.game.line].children).forEach(e=>{this.sourceBlock.appendChild(e),delete e.dataset.placed}),this.items.forEach(e=>{this.rows[this.game.line].appendChild(e),e.dataset.placed="true"}),this.game.skipped.push(this.game.line-1),this.checkSource()}dragStart(e){const s=e.target;s.classList.add("drag"),this._drag.item=s}dragEnd(e){e.target.classList.remove("drag"),this._drag.item=null}dragEnter(e){e.preventDefault(),e.currentTarget.classList.add("highlight")}dragOver(e){e.preventDefault()}dragOverItem(e){e.preventDefault();const s=e.currentTarget;if(s!==this._drag.over){this._drag.over&&this._drag.over.classList.remove("slide-left","slide-right"),this._drag.neigh&&this._drag.neigh.classList.remove("slide-left","slide-right"),this._drag.over=s;const i=s.getBoundingClientRect(),o=i.x+i.width/2;if(e.clientX-o>0){s.classList.add("slide-left");const l=s.nextElementSibling;l&&(this._drag.neigh=l,l.classList.add("slide-right"))}else{s.classList.add("slide-right");const l=s.previousElementSibling;l&&(this._drag.neigh=l,l.classList.add("slide-left"))}}}dropCard(e){const s=e.currentTarget;s.classList.remove("highlight"),this._drag.item&&this._drag.over&&this._drag.over.parentElement===s?e.clientX>this._drag.over.getBoundingClientRect().left+this._drag.over.offsetWidth/2?s.insertBefore(this._drag.item,this._drag.over.nextSibling):s.insertBefore(this._drag.item,this._drag.over):this._drag.item&&(s.append(this._drag.item),s!==this.sourceBlock&&(this._drag.item.dataset.placed="true")),this._drag.over&&this._drag.over.classList.remove("slide-left","slide-right"),this._drag.neigh&&this._drag.neigh.classList.remove("slide-left","slide-right"),this.opt.sound&&z.play("drop"),this.checkSource()}setDragReceiveListeners(e){e.addEventListener("dragenter",this.dragEnter,!0),e.addEventListener("dragover",this.dragOver,!0),e.addEventListener("drop",this.dropCard,!0)}removeDragReceiveListeners(e){e.removeEventListener("dragenter",this.dragEnter,!0),e.removeEventListener("dragover",this.dragOver,!0),e.removeEventListener("drop",this.dropCard,!0)}init(){this.refreshSettings();const e=this.drawField();return this.game.level=this.progress.level,this.game.page=this.progress.round+1,(this.game.level!==0||this.game.page!==0)&&j.show("Your progress was successfully restored"),p.change({level:this.game.level,page:this.game.page},[this.baseChangeCallback,this.levelChangeCallback,this.lineChangeCallback]),this.levelSelect.addEventListener("change",this.changeHandler.bind(this)),this.pageSelect.addEventListener("change",this.changeHandler.bind(this)),this.autoComplete.addEventListener("click",this.autoCompleteHandler.bind(this)),this.setDragReceiveListeners(this.sourceBlock),this.isInitialized||(window.addEventListener("resize",this.resizeHandler),f.el.addEventListener("click",this.continueHandler),B.el.addEventListener("click",this.showResults),this.isInitialized=!0),e}}const se=new tt,ne="./assets/moon.svg",st="./assets/sun.svg",nt={picture:"./assets/picture.svg",sound:"./assets/sound.svg",translation:"./assets/translation.svg",dark:ne},V=["sound","picture","translation","dark"];class it{constructor(){a(this,"_el");a(this,"_options",{sound:null,picture:null,translation:null,dark:null});a(this,"switchHandler",t=>{const e=t.currentTarget,s=e.dataset.option;if(e&&s){const i=!e.classList.contains("active");e.classList.toggle("active",i);const o=C();if(fe({...o,[s]:i}),se.setSetting(s,i),s==="dark"){const l=e.firstChild;l.src=i?ne:st,document.documentElement.classList.toggle("dark",i)}}});a(this,"getSettingsMenu",()=>{const t=C(),e=r("ul",{className:"settings"});return V.forEach(s=>{const i=t[s]?" active":"",o=r("li",{className:`settings__item${i}`,onClick:this.switchHandler.bind(this)});o.dataset.option=s;const l=r("img",{className:"settings__icon",src:nt[s]});o.append(l),this._options[s]=o,e.append(o)}),e});this._el=this.getSettingsMenu()}get el(){return this._el}refresh(){const t=C();V.forEach(e=>{var s;(s=this._options[e])==null||s.classList.toggle("active",t[e])}),this._el.classList.remove("hidden")}}const ie=new it,ot="_header__logo_2c5ki_1",rt="_header__logo_img_2c5ki_13",at="_header__title_2c5ki_18",lt="_header__menu_2c5ki_22",x={header__logo:ot,header__logo_img:rt,header__title:at,header__menu:lt},J="./assets/favicon.png",ct=()=>{const n=r("header",{className:"header"}),t=r("div",{className:x.header__menu});t.append(ie.el,F());const e=r("div",{className:x.header__logo,src:J,onClick:()=>g.go("/")});return e.append(r("img",{className:x.header__logo_img,src:J,alt:"logo"}),r("h1",{className:x.header__title,textContent:"Puzzle"})),n.append(e,t),n},dt=()=>r("main",{className:"main"}),ht=()=>{const n=r("footer",{className:"footer"}),t=r("div",{className:"footer__author"}),e=r("span",{textContent:"© 2024"}),s=r("img",{className:"footer__author_avatar",src:"./assets/ranjy_hex.png"}),i=r("a",{textContent:"mrHoft",href:"https://github.com/mrHoft"});t.append(e,s,i);const o=r("a",{className:"footer__rss_logo",href:"https://rs.school/"});return n.append(t,o),n},ut="_form__input_container_wlcbr_1",mt="_form__input_wlcbr_1",gt="_form__input_valid_wlcbr_27",_t="_form__input_label_wlcbr_39",N={form__input_container:ut,form__input:mt,form__input_valid:gt,form__input_label:_t},K=({name:n,type:t="text",placeholder:e="",...s})=>{const i=r("div",{className:N.form__input_container}),o=r("input",{name:n,className:N.form__input,id:`form_${n}`,type:t,placeholder:"",minLength:3,maxLength:16,required:!0,autocomplete:"off",...s}),l=r("label",{className:N.form__input_label,textContent:e,htmlFor:`form_${n}`}),d=r("span",{className:N.form__input_valid,textContent:"✔"});return i.append(o,l,d),i},pt="_form__submit_1beo6_1",ft={form__submit:pt},vt=({children:n,disabled:t})=>r("button",{className:ft.form__submit,type:"submit",disabled:t,textContent:n}),wt="_login_e5htv_1",bt="_login__form_e5htv_14",D={login:wt,login__form:bt},Ct=n=>{var e,s;const t=n.currentTarget;if(t){const i=new FormData(t),o={name:((e=i.get("name"))==null?void 0:e.toString())||"",surname:((s=i.get("surname"))==null?void 0:s.toString())||""};ue(o),n.preventDefault(),j.show("Successfully registered"),g.go("/")}},X="latin letters and the hyphen ('-') symbol. First letter must be uppercase.",yt=()=>{const n=document.createDocumentFragment(),t=r("h1",{className:D.login__header,textContent:"Please enter your name"}),e=r("form",{className:D.login__form});e.addEventListener("submit",Ct);const s="^[A-Z][a-z\\-]+",i=K({name:"name",placeholder:"first name",minLength:"3",pattern:s,title:`3-16 ${X}`}),o=K({name:"surname",placeholder:"surname",minLength:"4",pattern:s,title:`4-16 ${X}`}),l=vt({children:"Login"});e.append(i,o,l),n.append(t,e);const d=r("section",{className:D.login});return d.append(n),d},Lt="_welcome_1ri9j_1",zt="_welcome__title_1ri9j_14",kt="_welcome__user_1ri9j_19",xt="_welcome__descr_list_1ri9j_23",E={welcome:Lt,welcome__title:zt,welcome__user:kt,welcome__descr_list:xt},Nt=["Click on words, collect phrases.","Words can be drag and drop.","Use menu icons to switch tooltips."],Et=()=>{const n=M(),t=r("section",{className:E.welcome});t.append(r("h1",{className:E.welcome__title,textContent:"English puzzle game"})),n&&t.append(r("p",{className:E.welcome__user,textContent:`Welcome ${n.name} ${n.surname}!`}));const e=r("ul",{className:E.welcome__descr_list});return e.append(...Nt.map(s=>r("li",{textContent:s}))),t.append(e,r("button",{className:"button",textContent:"Start",onClick:()=>g.go("/game")})),t};function St(){const n=document.createDocumentFragment();return n.append(r("h1",{textContent:"(404) Page not found!"}),r("button",{className:"button",textContent:"← Home",onClick:()=>g.go("/")})),n}const S=n=>{const t=w("main");t.innerHTML="",t.append(n)},$={404:()=>{S(St())},login:()=>{S(yt())},home:()=>{const n=M(),t=w(".settings");if(!n){t.classList.add("hidden"),g.go("/login");return}ie.refresh(),S(Et()),F()},game:()=>{S(se.init())}},$t=()=>{const{dark:n}=C();document.documentElement.classList.toggle("dark",n),g.use("/",$.home).use("/login",$.login).use("/game",$.game).use("/404",$[404]).start()},Bt=()=>{const n=document.createDocumentFragment();return n.append(ct(),dt(),ht(),r("div",{className:"body__bg"}),A.el,j.el),n};document.body.prepend(Bt());$t();

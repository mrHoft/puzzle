var re=Object.defineProperty;var ae=(n,t,e)=>t in n?re(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var a=(n,t,e)=>(ae(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();class le{constructor(t,e){a(this,"_pathname");a(this,"_page");a(this,"_block");this._pathname=t,this._page=e,this._block=!1}get pathname(){return this._pathname}navigate(t){this.match(t)&&(this._pathname=t,this.render())}leave(){this._block}match(t){return t===this._pathname}render(){this._block=!0,this._page()}}class ce{constructor(t){a(this,"history",window.history);a(this,"routes",[]);a(this,"_currentRoute",null);a(this,"_rootQuery","/");this._rootQuery=t??window.location.pathname}use(t,e){const s=new le(t,e);return this.routes.push(s),this}start(){window.onpopstate=()=>{this._onRoute(window.location.pathname)},this._onRoute(window.location.pathname)}_onRoute(t){const e=t.substring(t.lastIndexOf("/"));let s=this.getRoute(e);s||(s=this.getRoute("/404")),s&&(this._currentRoute&&this._currentRoute.leave(),this._currentRoute=s,s.render())}go(t){this.history.pushState({route:t},"",`${this._rootQuery}${t}`.replace("//","/")),this._onRoute(t)}back(){this.history.back()}forward(){this.history.forward()}getRoute(t){return t?this.routes.find(e=>e.match(t))||null:this._currentRoute}}const m=new ce,X=n=>Object.keys(n);function v(n,t=document){const e=t.querySelector(n);if(e)return e;throw new Error(`${n} was not found in ${t instanceof Document?"document":t.tagName}`)}function r(n,t){const e=document.createElement(n);return X(t).forEach(s=>{const i=t[s];if(i!==void 0)switch(s){case"name":{n==="select"&&(e.name=i),n==="input"&&(e.name=i);break}case"src":{n==="img"&&(e.src=i);break}case"href":{n==="a"&&(e.href=i);break}case"onClick":{e.onclick=t.onClick;break}default:Object.assign(e,{[s]:i})}}),e}function he(n,t,e){if(n!==Object(n))return n;if(typeof t!="string"||t==="")throw new Error("App store. Path must be type of string.");let s=n;const i=t.split("."),o=i.pop();return i.forEach(l=>{s[l]||(s[l]={}),s=s[l]}),o&&(s[o]=e),n}function de(n,t){if(n!==Object(n)||typeof t!="string"||t==="")throw new Error(`App store. Wrong path: ${t}`);return t.split(".").reduce((e,s)=>e&&e[s]!==void 0?e[s]:void 0,n)}const L=class L{constructor(){a(this,"_state",{});const t=localStorage.getItem(L.STORE_NAME);t&&(this._state=JSON.parse(t))}getState(){return this._state}removeState(){this._state={},this.emit()}get(t){return de(this._state,t)}set(t,e){he(this._state,t,e),this.emit()}emit(){localStorage.setItem(L.STORE_NAME,JSON.stringify(this._state))}};a(L,"STORE_NAME","PuzzleStore");let H=L;const g=new H;function A(){const n=g.get("user");return n&&Object.prototype.hasOwnProperty.call(n,"name")&&Object.prototype.hasOwnProperty.call(n,"surname")?n:null}function ue(n){if(!n||!Object.prototype.hasOwnProperty.call(n,"name")||!Object.prototype.hasOwnProperty.call(n,"surname"))throw new Error("User data is incorrect.");g.set("user",n)}function me(){g.set("user",void 0)}const ge=()=>typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",_e=ge()==="dark",G=["sound","picture","translation"],pe={sound:!0,picture:!0,translation:!0,dark:_e};function C(){const n=g.get("settings");return n&&G.every(t=>Object.prototype.hasOwnProperty.call(n,t))?n:{...pe}}function fe(n){if(!n||G.some(t=>!Object.prototype.hasOwnProperty.call(n,t)))throw new Error("Settings data is incorrect.");g.set("settings",n)}function ve(){g.set("settings",void 0)}const Y=["level","round"],we={level:0,round:-1,level_completed:"",round_completed:""};function be(){const n=g.get("progress");return n&&Y.every(t=>Object.prototype.hasOwnProperty.call(n,t))?n:{...we}}function Ce(n){if(!n||Y.some(t=>!Object.prototype.hasOwnProperty.call(n,t)))throw new Error("Progress data is incorrect.");g.set("progress",n)}function ye(){g.set("progress",void 0)}const Le="./assets/login.svg",ze="./assets/logout.svg";function ke({name:n,surname:t}){return`${(n??"").charAt(0)}${(t??"").charAt(0)}`}const M=()=>{const n=A();function t(){me(),ve(),ye(),M(),m.go("/")}const e=document.getElementById("user")??r("div",{className:"user__menu",id:"user"});e.onclick=n?t:()=>m.go("/login"),e.innerHTML="";const s=r("img",{className:n?"user__menu_icon opaque":"user__menu_icon",src:n?ze:Le});return e.append(s),n&&e.append(ke(n)),e};class xe{constructor(){a(this,"_game",{level:0,page:0,line:0,skipped:[],fullfilled:!1,passed:!1,rounds:0,image:""});a(this,"_sentence",[]);a(this,"_items",[]);a(this,"elements",{levelSelect:null,pageSelect:null,puzzleBody:null,imageInfo:null,sourceText:null,sourceBlock:null,autoComplete:null});a(this,"rows",[]);a(this,"marks",[])}get game(){return this._game}get sentence(){return this._sentence}get items(){return this._items}set items(t){this._items=t}get levelSelect(){if(!this.elements.levelSelect)throw new Error("No levelSelect element");return this.elements.levelSelect}get pageSelect(){if(!this.elements.pageSelect)throw new Error("No pageSelect element");return this.elements.pageSelect}get puzzleBody(){if(!this.elements.puzzleBody)throw new Error("No puzzleBody element");return this.elements.puzzleBody}get imageInfo(){if(!this.elements.imageInfo)throw new Error("No imageInfo element");return this.elements.imageInfo}get sourceText(){if(!this.elements.sourceText)throw new Error("No sourceText element");return this.elements.sourceText}get sourceBlock(){if(!this.elements.sourceBlock)throw new Error("No sourceBlock element");return this.elements.sourceBlock}get autoComplete(){if(!this.elements.autoComplete)throw new Error("No autoComplete element");return this.elements.autoComplete}}const Ne="_speech__btn_1oie2_1",Ee="_speech__btn_icon_1oie2_19",Se="_speech__btn_active_1oie2_27",$e="_spin_1oie2_1",R={speech__btn:Ne,speech__btn_icon:Ee,speech__btn_active:Se,spin:$e},Be="./assets/sound.svg",Oe="./assets/loading.svg";class Z{constructor(t){a(this,"_el");a(this,"_status");a(this,"_audio",null);a(this,"clickHandler",()=>{this._audio&&this._audio.play()});a(this,"getSpeechButton",()=>{const t=r("div",{className:R.speech__btn,onClick:this.clickHandler}),e=r("img",{className:`${R.speech__btn_active} hidden`,src:Oe}),s=r("img",{className:R.speech__btn_icon,src:Be});return t.append(e,s),[t,e]});const[e,s]=this.getSpeechButton();this._el=e,this._status=s,t&&(this.audio=t)}get el(){return this._el}set audio(t){this._audio=new Audio(t),this._audio.addEventListener("play",()=>{this._status.classList.remove("hidden")}),this._audio.addEventListener("ended",()=>{this._status.classList.add("hidden")})}}const y=new Z;class Pe extends xe{constructor(){super(...arguments);a(this,"_settings",{picture:!0,sound:!0,translation:!0,dark:!0});a(this,"_progress",{level:0,round:-1,level_completed:"",round_completed:""})}get opt(){return this._settings}get progress(){return this._progress}roundCompleted(e){return this._progress.round_completed.split(",").filter(s=>Number(s.charAt(0))===e).map(s=>Number(s.split("_")[1]))}levelCompleted(){return this._progress.level_completed.split(",").filter(e=>e!=="").map(e=>Number(e))}refreshSettings(){this._settings=C(),this._progress=be()}setSetting(e,s){switch(this._settings[e]=s,e){case"translation":{this.sourceText&&this.sourceText.classList.toggle("hidden",!s);break}case"sound":{y.el.classList.toggle("hidden",!s);break}case"picture":{v(":root").style.setProperty("--puzzle-hint-img",s?`url(${this.game.image})`:"unset");break}}}setProgress(e,s){this._progress.level=e,this._progress.round=s;const i=`${e}_${s}`,o=this._progress.round_completed.split(",");o.includes(i)||(o.push(i),this._progress.round_completed=o.join(",")),Ce(this._progress)}}function ee(n){const t=v(".puzzle__body").getBoundingClientRect(),{width:e,height:s,top:i,left:o}=n.getBoundingClientRect(),l=n.firstElementChild,h=n.lastElementChild;n.style.width=`${e.toFixed(2)}px`,n.style.height=`${s.toFixed(2)}px`,l.style.backgroundPosition=`-${o-t.left}px -${i-t.top}px`,h.style.backgroundPosition=`-${o-t.left+e-8.5}px -${i-t.top+16}px`,n.classList.remove("grow"),n.classList.add("opaque")}class Re{constructor(t){a(this,"textContent");a(this,"_el");this.textContent=t,this._el=this.create()}get el(){return this._el}create(){const t=r("div",{className:"puzzle__item grow",draggable:!0}),e=r("div",{}),s=r("div",{});t.append(e,this.textContent,s);const i=new MutationObserver(()=>{document.contains(t)&&(ee(t),i.disconnect())});return i.observe(document,{attributes:!1,childList:!0,characterData:!1,subtree:!0}),t}}class Te{constructor(){a(this,"_el");a(this,"_state","check");this._el=this.init()}get el(){return this._el}get state(){return this._state}set state(t){t==="hidden"&&this._el.classList.add("hidden"),t==="check"&&(this._el.textContent="Check",this._el.classList.remove("hidden","ready","fail")),t==="ready"&&(this._el.textContent="Continue",this._el.classList.remove("hidden","fail"),this._el.classList.add("ready")),t==="fail"&&(this._el.classList.remove("hidden","ready"),this._el.classList.add("fail"))}init(){return r("div",{className:"puzzle__source_btn hidden",textContent:"Check"})}}const p=new Te;class De{constructor(){a(this,"_el");a(this,"_state","hidden");this._el=this.init()}get el(){return this._el}get state(){return this._state}set state(t){t==="hidden"&&this._el.classList.add("hidden"),t==="ready"&&(this._el.classList.remove("hidden"),this._el.classList.add("results"))}init(){return r("div",{className:"puzzle__source_btn hidden",textContent:"Results"})}}const B=new De;class He extends Pe{setOptions(t,e,s=0){t.innerHTML="",e.forEach((i,o)=>{const l=new Option(`${(o+1).toString()}${i?" ✔":""}`,o.toString(),!1,s===o);l.className=`puzzle__select_option${i?" done":""}`,t.append(l)})}setRow(t,e){const s=e.split(" ");this.rows[t].innerHTML="",s.forEach((i,o)=>{const{el:l}=new Re(i);o===0?l.classList.add("first"):o===s.length-1?l.classList.add("last"):l.classList.add("mid"),this.rows[t].append(l)})}drawField(){const t=r("div",{className:"puzzle"});return t.append(this.createSelectors(),this.createPuzzleBody(),this.createImageInfo(),this.createSourceBlock()),t}createSelectors(){const t=r("label",{className:"puzzle__level_label",textContent:"Level "});this.elements.levelSelect=r("select",{className:"puzzle__level",name:"level"}),t.appendChild(this.elements.levelSelect);const e=r("label",{className:"puzzle__page_label",textContent:"Page "});this.elements.pageSelect=r("select",{className:"puzzle__page",name:"page"}),e.appendChild(this.elements.pageSelect);const s=r("div",{className:"puzzle__select"});return s.append(t,e),s}createPuzzleBody(){this.elements.puzzleBody=r("div",{className:"puzzle__body"});for(let t=1;t<=10;t+=1){const e=r("div",{className:`puzzle__row row_${t}`});this.rows[t]=e;const s=r("div",{className:"puzzle__row_mark",textContent:t.toString()});this.marks[t]=s,this.elements.puzzleBody.append(s,e)}return this.elements.puzzleBody}createImageInfo(){return this.elements.imageInfo=r("div",{className:"puzzle__image_info hidden"}),this.elements.imageInfo}createSourceBlock(){const t=r("div",{className:"puzzle__source_container"}),e=r("div",{className:"puzzle__hints"});this.elements.sourceText=r("p",{className:"puzzle__source_text"}),e.append(y.el,this.sourceText),this.elements.sourceBlock=r("div",{className:"puzzle__source"}),this.elements.autoComplete=r("div",{className:"puzzle__source_auto",textContent:"Auto-Complete"});const s=r("div",{});return s.append(p.el,B.el),t.append(e,this.sourceBlock,this.autoComplete,s),t}}class Ie{constructor(){a(this,"round",[])}}const Ae=n=>`./data/wordCollectionLevel${n+1}.json`;class Me extends Ie{constructor(){super(...arguments);a(this,"_state",{level:0,page:0})}get(){const{level:e,page:s}=this._state;return new Promise(i=>{if(this.round[e]){const o=this.round[e].length;if(s>=o){i(this.round[e][o-1]);return}i(this.round[e][s])}else fetch(Ae(e),{method:"GET",headers:{Accept:"application/json"}}).then(o=>o.json()).then(o=>{if(o&&Object.prototype.hasOwnProperty.call(o,"rounds")){const{rounds:h}=o;this.round[e]=h}const l=this.round[e].length;if(s>=l){i(this.round[e][l-1]);return}i(this.round[e][s])})})}change({level:e,page:s},i){e!==void 0&&e!==this._state.level&&(s=0),this._state={level:e!==void 0?e:this._state.level,page:s!==void 0?s:this._state.page},this.get().then(()=>{i&&i.forEach(o=>o())})}}const _=new Me;function Fe(n){const t=Array.from(n);let e=t.length,s=0;for(;e>0;)s=Math.floor(Math.random()*e),e-=1,[t[e],t[s]]=[t[s],t[e]];return t}const je="_modal__wrapper_10yu2_1",qe="_reveal_10yu2_1",Ue="_modal__outer_10yu2_26",Ve="_modal__inner_10yu2_40",We="_modal__close_10yu2_47",z={modal__wrapper:je,reveal:qe,modal__outer:Ue,modal__inner:Ve,modal__close:We},Qe="./assets/close.svg";class Je{constructor(){a(this,"_el");a(this,"_inner");a(this,"close",()=>{this._el.classList.add("hidden")});a(this,"handleClick",t=>{const{target:e,currentTarget:s}=t;e===s&&(t.preventDefault(),this.close())});a(this,"init",()=>{const t=r("div",{className:`${z.modal__wrapper} hidden`,onClick:this.handleClick}),e=r("div",{className:z.modal__outer}),s=r("div",{className:z.modal__close,onClick:this.close}),i=r("img",{src:Qe});s.append(i);const o=r("div",{className:z.modal__inner});return e.append(s,o),t.append(e),{modal:t,inner:o}});const{modal:t,inner:e}=this.init();this._el=t,this._inner=e}get el(){return this._el}show(t){this._el.classList.remove("hidden"),this._inner.innerHTML="",this._inner.append(t)}}const O=new Je,U=(n,t)=>{const e=document.createDocumentFragment(),s=r("p",{className:"results__words_title",textContent:n}),i=r("ul",{className:"results__words_list"});return i.append(...t.map(o=>{const l=r("li",{className:"results__words_item"});return l.append(new Z(o.sound).el,o.sentence),l})),e.append(s,i),e},Ke=({level:n,round:t,src:e,name:s,year:i,words:o,skipped:l,onClick:h})=>{const c=document.createDocumentFragment(),d=r("h2",{className:"results__title",textContent:"Page completed!"}),f=r("p",{className:"results__level",textContent:`Level: ${n+1}. Page: ${t+1}.`}),u=r("img",{className:"results__thumb",src:e,alt:"thumbnail"}),w=r("p",{className:"results__descr",textContent:`${s} (${i})`}),j=r("div",{className:"results__words scrolled"}),q=o.filter((oe,P)=>!l.includes(P));j.append(U(`Solution used (${l.length}):`,o.filter((oe,P)=>l.includes(P))),U(`Solved (${q.length}):`,q));const ie=r("button",{className:"button",textContent:"Continue",onClick:()=>{h(),O.close()}});c.append(d,f,u,w,j,ie),O.show(c)},V={drop:"./assets/drop.mp3",match:"./assets/match.mp3",tada:"./assets/tada.mp3"};class Xe{constructor(){a(this,"_audio");this._audio=X(V).reduce((t,e)=>(t[e]=new Audio(V[e]),t),{})}play(t){var e;(e=this._audio[t])==null||e.play()}}const k=new Xe,Ge="_message__wrapper_1tezc_1",Ye="_message__icon_1tezc_28",T={message__wrapper:Ge,"slide-down":"_slide-down_1tezc_1",message__icon:Ye};class Ze{constructor(){a(this,"_el");a(this,"_text");a(this,"_timer",null);a(this,"init",()=>{const t=r("div",{className:`${T.message__wrapper} hidden`}),e=r("div",{className:T.message__icon,textContent:"✔"}),s=r("div",{className:T.message__text});return t.append(e,s),{message:t,text:s}});const{message:t,text:e}=this.init();this._el=t,this._text=e}get el(){return this._el}show(t){this._el.classList.remove("hidden"),this._text.textContent=t,this._timer&&(clearTimeout(this._timer),this._timer=null),this._timer=setTimeout(()=>this._el.classList.add("hidden"),3e3)}}const F=new Ze,x="https://raw.githubusercontent.com/rolling-scopes-school/rss-puzzle-data/main/";class et extends He{constructor(){super();a(this,"_drag",{item:null,over:null,neigh:null});a(this,"_field",{size:0});a(this,"isInitialized",!1);a(this,"levelChangeCallback",()=>{const e=_.round[this.game.level].length;this.game.rounds=e;const s=this.roundCompleted(this.game.level),i=Array.from({length:e},(h,c)=>s.includes(c));this.setOptions(this.pageSelect,i,this.game.page);const o=this.levelCompleted(),l=Array.from({length:6},(h,c)=>o.includes(c));this.setOptions(this.levelSelect,l,this.game.level)});a(this,"lineChangeCallback",()=>setTimeout(()=>this.setSource(),100));a(this,"showResults",()=>{_.get().then(e=>{Ke({level:this.game.level,round:this.game.page,src:`${x}images/${e.levelData.imageSrc}`,name:e.levelData.name,year:e.levelData.year,words:e.words.map(s=>({sentence:s.textExample,sound:`${x}${s.audioExample}`})),skipped:this.game.skipped,onClick:this.continueHandler.bind(this)})})});a(this,"continueHandler",()=>{if(this.game.passed){if(this.lineComplete(),this.game.passed=!1,this.game.line+=1,this.game.line<=10){this.setSource();return}this.nextRound()}else{const e=this.sentenceCheck();p.state=e?"ready":"fail",e&&(this.sourceText.classList.remove("hidden"),y.el.classList.remove("hidden"),this.game.line===10&&this.pageComplete())}});a(this,"resizeHandler",()=>{var s;if(((s=m.getRoute())==null?void 0:s.pathname)!=="/game")return;const e=Math.floor(this.puzzleBody.getBoundingClientRect().width);if(e!==this._field.size){this._field.size=e;const i=v(":root"),{width:o,height:l}=this.puzzleBody.getBoundingClientRect();i.style.setProperty("--puzzle-size",`${o}px ${l}px`);const{height:h}=this.rows[1].getBoundingClientRect();this.rows.forEach((c,d)=>{c.style.backgroundPosition=`0px -${h*(d-1)}px`}),this.items.forEach(c=>{this.rows[this.game.line].appendChild(c)});for(let c=1;c<11;c+=1){const d=this.rows[c].children;Array.from({length:d.length},(u,w)=>d[w]).forEach(u=>{u.removeAttribute("style"),u.classList.add("grow"),u.classList.add("opaque")})}for(let c=1;c<11;c+=1){const d=this.rows[c].children;Array.from({length:d.length},(u,w)=>d[w]).forEach(u=>{ee(u),c<=this.game.line&&u.classList.remove("opaque")})}this.items.forEach(c=>{this.sourceBlock.appendChild(c),delete c.dataset.placed})}});this.baseChangeCallback=this.baseChangeCallback.bind(this),this.dragEnter=this.dragEnter.bind(this),this.dragOver=this.dragOver.bind(this),this.dropCard=this.dropCard.bind(this)}baseChangeCallback(){this.game.line=1,this.game.skipped=[],this.game.passed=!1,p.state="hidden",B.state="hidden";const e=v(":root");_.get().then(s=>{this.game.image=`${x}images/${s.levelData.imageSrc}`,e.style.setProperty("--puzzle-img",`url(${this.game.image})`),this.opt.picture&&e.style.setProperty("--puzzle-hint-img",`url(${this.game.image})`);const{width:i,height:o}=this.puzzleBody.getBoundingClientRect();e.style.setProperty("--puzzle-size",`${i}px ${o}px`);const{height:l}=this.rows[1].getBoundingClientRect();this.rows.forEach((h,c)=>{h.classList.remove("complete"),this.removeDragReceiveListeners(h),h.style.backgroundPosition=`0px -${l*(c-1)}px`}),this.marks.forEach(h=>h.classList.remove("complete")),this.imageInfo.textContent=`${s.levelData.name} (${s.levelData.year})`,this.imageInfo.classList.add("hidden"),s.words.forEach((h,c)=>{this.setRow(c+1,h.textExample),this.sentence[c]=h.textExample})})}nextRound(){this.setProgress(this.game.level,this.game.page),this.game.page+=1;const e=[this.baseChangeCallback,this.levelChangeCallback,this.lineChangeCallback];if(this.game.page>=this.game.rounds){this.game.page=0,this.game.level+=1,this.game.level>5&&(this.game.level=0),_.change({level:this.game.level},e);return}_.change({page:this.game.page},e)}changeHandler(e){const s=e.target,{name:i}=s,o=Number(s.value),l=[this.baseChangeCallback,this.lineChangeCallback];(i==="level"||i==="page")&&(this.game[i]=o),i==="level"&&(this.game.page=0,l.push(this.levelChangeCallback)),_.change({[i]:o},l)}lineComplete(){Array.from(this.rows[this.game.line].children).forEach(e=>e.classList.remove("active")),this.removeDragReceiveListeners(this.rows[this.game.line]),this.rows[this.game.line].classList.add("complete"),this.marks[this.game.line].classList.add("complete")}pageComplete(){this.imageInfo.classList.remove("hidden"),this.lineComplete(),this.opt.sound&&k.play("tada"),B.state="ready";for(let e=1;e<=10;e+=1)Array.from(this.rows[e].children).forEach(s=>{s.textContent=""})}sentenceCheck(){const s=Array.from(this.rows[this.game.line].children).reduce((i,o)=>`${i} ${o.textContent}`,"").trim();return this.game.passed=this.sentence[this.game.line-1]===s,this.game.passed&&this.opt.sound&&k.play("match"),this.game.passed}checkSource(){this.sourceBlock.children.length?this.game.fullfilled&&(this.game.fullfilled=!1,this.sourceBlock.classList.remove("hidden"),this.autoComplete.classList.remove("hidden"),p.state="hidden",this.game.passed=!1):(this.game.fullfilled=!0,this.sourceBlock.classList.add("hidden"),this.autoComplete.classList.add("hidden"),p.state="check")}setSource(){_.get().then(i=>{this.sourceText.textContent=i.words[this.game.line-1].textExampleTranslate,this.sourceText.classList.toggle("hidden",!this.opt.translation),y.audio=`${x}${i.words[this.game.line-1].audioExample}`}),y.el.classList.toggle("hidden",!this.opt.sound),this.sourceBlock.classList.remove("hidden"),this.autoComplete.classList.remove("hidden"),p.state="hidden";const e=i=>{const o=i.currentTarget,{placed:l}=o.dataset;l?(this.sourceBlock.appendChild(o),delete o.dataset.placed):(this.rows[this.game.line].appendChild(o),o.dataset.placed="true"),this.opt.sound&&k.play("drop"),this.checkSource()};this.setDragReceiveListeners(this.rows[this.game.line]),this.sourceBlock.innerHTML="",this.items=Array.from({length:this.rows[this.game.line].children.length},(i,o)=>this.rows[this.game.line].children[o]),Fe(this.items).forEach(i=>{this.sourceBlock.appendChild(i),i.classList.remove("opaque"),i.classList.add("active"),i.addEventListener("click",e),i.addEventListener("dragstart",this.dragStart.bind(this)),i.addEventListener("dragend",this.dragEnd.bind(this)),i.addEventListener("dragover",this.dragOverItem.bind(this))})}autoCompleteHandler(){Array.from(this.rows[this.game.line].children).forEach(e=>{this.sourceBlock.appendChild(e),delete e.dataset.placed}),this.items.forEach(e=>{this.rows[this.game.line].appendChild(e),e.dataset.placed="true"}),this.game.skipped.push(this.game.line-1),this.checkSource()}dragStart(e){const s=e.target;s.classList.add("drag"),this._drag.item=s}dragEnd(e){e.target.classList.remove("drag"),this._drag.item=null}dragEnter(e){e.preventDefault(),e.currentTarget.classList.add("highlight")}dragOver(e){e.preventDefault()}dragOverItem(e){e.preventDefault();const s=e.currentTarget;if(s!==this._drag.over){this._drag.over&&this._drag.over.classList.remove("slide-left","slide-right"),this._drag.neigh&&this._drag.neigh.classList.remove("slide-left","slide-right"),this._drag.over=s;const i=s.getBoundingClientRect(),o=i.x+i.width/2;if(e.clientX-o>0){s.classList.add("slide-left");const l=s.nextElementSibling;l&&(this._drag.neigh=l,l.classList.add("slide-right"))}else{s.classList.add("slide-right");const l=s.previousElementSibling;l&&(this._drag.neigh=l,l.classList.add("slide-left"))}}}dropCard(e){const s=e.currentTarget;s.classList.remove("highlight"),this._drag.item&&this._drag.over&&this._drag.over.parentElement===s?e.clientX>this._drag.over.getBoundingClientRect().left+this._drag.over.offsetWidth/2?s.insertBefore(this._drag.item,this._drag.over.nextSibling):s.insertBefore(this._drag.item,this._drag.over):this._drag.item&&(s.append(this._drag.item),s!==this.sourceBlock&&(this._drag.item.dataset.placed="true")),this._drag.over&&this._drag.over.classList.remove("slide-left","slide-right"),this._drag.neigh&&this._drag.neigh.classList.remove("slide-left","slide-right"),this.opt.sound&&k.play("drop"),this.checkSource()}setDragReceiveListeners(e){e.addEventListener("dragenter",this.dragEnter,!0),e.addEventListener("dragover",this.dragOver,!0),e.addEventListener("drop",this.dropCard,!0)}removeDragReceiveListeners(e){e.removeEventListener("dragenter",this.dragEnter,!0),e.removeEventListener("dragover",this.dragOver,!0),e.removeEventListener("drop",this.dropCard,!0)}init(){const e=this.drawField();return this.refreshSettings(),this.game.level=this.progress.level,this.game.page=this.progress.round+1,(this.game.level!==0||this.game.page!==0)&&F.show("Your progress was successfully restored"),_.change({level:this.game.level,page:this.game.page},[this.baseChangeCallback,this.levelChangeCallback,this.lineChangeCallback]),this.levelSelect.addEventListener("change",this.changeHandler.bind(this)),this.pageSelect.addEventListener("change",this.changeHandler.bind(this)),this.autoComplete.addEventListener("click",this.autoCompleteHandler.bind(this)),this.setDragReceiveListeners(this.sourceBlock),this.isInitialized||(window.addEventListener("resize",this.resizeHandler),p.el.addEventListener("click",this.continueHandler),B.el.addEventListener("click",this.showResults),this.isInitialized=!0),e}}const te=new et,se="./assets/moon.svg",tt="./assets/sun.svg",st={picture:"./assets/picture.svg",sound:"./assets/sound.svg",translation:"./assets/translation.svg",dark:se},W=["sound","picture","translation","dark"];class nt{constructor(){a(this,"_el");a(this,"_options",{sound:null,picture:null,translation:null,dark:null});a(this,"switchHandler",t=>{const e=t.currentTarget,s=e.dataset.option;if(e&&s){const i=!e.classList.contains("active");e.classList.toggle("active",i);const o=C();if(fe({...o,[s]:i}),te.setSetting(s,i),s==="dark"){const l=e.firstChild;l.src=i?se:tt,document.documentElement.classList.toggle("dark",i)}}});a(this,"getSettingsMenu",()=>{const t=C(),e=r("ul",{className:"settings"});return W.forEach(s=>{const i=t[s]?" active":"",o=r("li",{className:`settings__item${i}`,onClick:this.switchHandler.bind(this)});o.dataset.option=s;const l=r("img",{className:"settings__icon",src:st[s]});o.append(l),this._options[s]=o,e.append(o)}),e});this._el=this.getSettingsMenu()}get el(){return this._el}refresh(){const t=C();W.forEach(e=>{var s;(s=this._options[e])==null||s.classList.toggle("active",t[e])}),this._el.classList.remove("hidden")}}const ne=new nt,it="_header__logo_2c5ki_1",ot="_header__logo_img_2c5ki_13",rt="_header__title_2c5ki_18",at="_header__menu_2c5ki_22",N={header__logo:it,header__logo_img:ot,header__title:rt,header__menu:at},Q="./assets/favicon.png",lt=()=>{const n=r("header",{className:"header"}),t=r("div",{className:N.header__menu});t.append(ne.el,M());const e=r("div",{className:N.header__logo,src:Q,onClick:()=>m.go("/")});return e.append(r("img",{className:N.header__logo_img,src:Q,alt:"logo"}),r("h1",{className:N.header__title,textContent:"Puzzle"})),n.append(e,t),n},ct=()=>r("main",{className:"main"}),ht=()=>{const n=r("footer",{className:"footer"}),t=r("div",{className:"footer__author"}),e=r("span",{textContent:"© 2024"}),s=r("img",{className:"footer__author_avatar",src:"./assets/ranjy_hex.png"}),i=r("a",{textContent:"mrHoft",href:"https://github.com/mrHoft"});t.append(e,s,i);const o=r("a",{className:"footer__rss_logo",href:"https://rs.school/"});return n.append(t,o),n},dt="_form__input_container_wlcbr_1",ut="_form__input_wlcbr_1",mt="_form__input_valid_wlcbr_27",gt="_form__input_label_wlcbr_39",E={form__input_container:dt,form__input:ut,form__input_valid:mt,form__input_label:gt},J=({name:n,onChange:t,onInput:e,type:s="text",placeholder:i="",...o})=>{const l=r("div",{className:E.form__input_container}),h=r("input",{name:n,className:E.form__input,id:`form_${n}`,type:s,placeholder:"",minLength:3,maxLength:16,required:!0,autocomplete:"off",...o});t&&(h.onchange=t),e&&(h.oninput=e);const c=r("label",{className:E.form__input_label,textContent:i,htmlFor:`form_${n}`}),d=r("span",{className:E.form__input_valid,textContent:"✔"});return l.append(h,c,d),l},_t="_form__submit_zq97y_1",pt={form__submit:_t},ft=({children:n,disabled:t})=>r("button",{className:pt.form__submit,type:"submit",disabled:t,textContent:n}),vt="_login_gecnm_1",wt="_login__form_gecnm_16",D={login:vt,login__form:wt},bt=n=>{var e,s;const t=n.currentTarget;if(t){const i=new FormData(t),o={name:((e=i.get("name"))==null?void 0:e.toString())||"",surname:((s=i.get("surname"))==null?void 0:s.toString())||""};ue(o),n.preventDefault(),F.show("Successfully registered"),m.go("/")}},I="^[A-Z][a-z\\-]+",K="latin letters and the hyphen ('-') symbol. First letter must be uppercase.";class Ct{constructor(t,e){a(this,"_name");a(this,"_surname");a(this,"pattern",I);a(this,"minLength",{name:3,surname:4});this._name=t,this._surname=e}get name(){return this._name.length>=this.minLength.name&&this._name.match(this.pattern)!==null}get surname(){return this._surname.length>=this.minLength.surname&&this._surname.match(this.pattern)!==null}get all(){return this.name&&this.surname}}const yt=()=>{const n=r("form",{className:D.login__form}),t=ft({children:"Login",disabled:!0}),e=()=>{var f,u;const h=new FormData(n),c={name:((f=h.get("name"))==null?void 0:f.toString())||"",surname:((u=h.get("surname"))==null?void 0:u.toString())||""},d=new Ct(c.name,c.surname).all;t.disabled=!d},s=r("h1",{className:D.login__header,textContent:"Please enter your name"});n.addEventListener("submit",bt);const i=J({name:"name",placeholder:"first name",minLength:"3",pattern:I,title:`3-16 ${K}`,onInput:e}),o=J({name:"surname",placeholder:"surname",minLength:"4",pattern:I,title:`4-16 ${K}`,onInput:e});n.append(i,o,t);const l=r("section",{className:D.login});return l.append(s,n),l},Lt="_welcome_1m6y7_1",zt="_welcome__title_1m6y7_16",kt="_welcome__user_1m6y7_21",xt="_welcome__descr_list_1m6y7_25",S={welcome:Lt,welcome__title:zt,welcome__user:kt,welcome__descr_list:xt},Nt=["Click on words, collect phrases.","Words can be drag and drop.","Use menu icons to switch tooltips."],Et=()=>{const n=A(),t=r("section",{className:S.welcome});t.append(r("h1",{className:S.welcome__title,textContent:"English puzzle game"})),n&&t.append(r("p",{className:S.welcome__user,textContent:`Welcome ${n.name} ${n.surname}!`}));const e=r("ul",{className:S.welcome__descr_list});return e.append(...Nt.map(s=>r("li",{textContent:s}))),t.append(e,r("button",{className:"button",textContent:"Start",onClick:()=>m.go("/game")})),t};function St(){const n=document.createDocumentFragment();return n.append(r("h1",{textContent:"(404) Page not found!"}),r("button",{className:"button",textContent:"← Home",onClick:()=>m.go("/")})),n}const $=n=>{const t=v("main");t.innerHTML="",t.append(n)},b={404:()=>{$(St())},login:()=>{$(yt())},home:()=>{const n=A(),t=v(".settings");if(!n){t.classList.add("hidden"),m.go("/login");return}ne.refresh(),$(Et()),M()},game:()=>{$(te.init())},test:()=>{O.show((()=>{const n=document.createDocumentFragment();for(let t=1;t<10;t+=1)n.append(r("p",{textContent:`Sample paragraph ${t}`}));return n})())}};function $t(){const{dark:n}=C();document.documentElement.classList.toggle("dark",n),m.use("/",b.home).use("/login",b.login).use("/game",b.game).use("/404",b[404]).use("/test",b.test).start()}const Bt=()=>{const n=document.createDocumentFragment();return n.append(lt(),ct(),ht(),r("div",{className:"body__bg"}),O.el,F.el),n};document.body.prepend(Bt());$t();

var ie=Object.defineProperty;var oe=(n,t,e)=>t in n?ie(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var a=(n,t,e)=>(oe(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function e(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=e(o);fetch(o.href,i)}})();class re{constructor(t,e){a(this,"_pathname");a(this,"_page");a(this,"_block");this._pathname=t,this._page=e,this._block=!1}get pathname(){return this._pathname}navigate(t){this.match(t)&&(this._pathname=t,this.render())}leave(){this._block}match(t){return t==this._pathname}render(){this._block=!0,this._page()}}const v=class v{constructor(t){a(this,"history",window.history);a(this,"routes",[]);a(this,"_currentRoute",null);a(this,"_rootQuery","/");if(v._instance)return v._instance;this._rootQuery=t??window.location.pathname,v._instance=this}use(t,e){const s=new re(t,e);return this.routes.push(s),this}start(){window.onpopstate=()=>{this._onRoute(window.location.pathname)},this._onRoute(window.location.pathname)}_onRoute(t){const e=t.substring(t.lastIndexOf("/"));let s=this.getRoute(e);s||(s=this.getRoute("/404")),s&&(this._currentRoute&&this._currentRoute.leave(),this._currentRoute=s,s.render())}go(t){this.history.pushState({route:t},"",`${this._rootQuery}${t}`.replace("//","/")),this._onRoute(t)}back(){this.history.back()}forward(){this.history.forward()}getRoute(t){return t?this.routes.find(e=>e.match(t))||null:this._currentRoute}};a(v,"_instance");let D=v;const _=new D,K=n=>Object.keys(n);function w(n,t=document){const e=t.querySelector(n);if(e)return e;throw new Error(`${n} was not found in ${t instanceof Document?"document":t.tagName}`)}function r(n,t){const e=document.createElement(n);return K(t).forEach(s=>{const o=t[s];if(o!=null)switch(s){case"name":{n==="select"&&(e.name=o),n==="input"&&(e.name=o);break}case"src":{n==="img"&&(e.src=o);break}case"href":{n==="a"&&(e.href=o);break}case"onClick":{e.onclick=t.onClick;break}default:Object.assign(e,{[s]:o})}}),e}const m=class m{constructor(){a(this,"_state",{});if(m._instance)return m._instance;const t=localStorage.getItem(m.STORE_NAME);t&&(this._state=JSON.parse(t)),m._instance=this}getState(){return this._state}removeState(){this._state={},this.emit()}get(t){return le(this._state,t)}set(t,e){ae(this._state,t,e),this.emit()}emit(){localStorage.setItem(m.STORE_NAME,JSON.stringify(this._state))}};a(m,"STORE_NAME","PuzzleStore"),a(m,"_instance");let I=m;function ae(n,t,e){if(n!==Object(n))return n;if(typeof t!="string"||t==="")throw new Error("App store. Path must be type of string.");let s=n;const o=t.split("."),i=o.pop();return o.forEach(l=>{s[l]||(s[l]={}),s=s[l]}),i&&(s[i]=e),n}function le(n,t){if(n!==Object(n)||typeof t!="string"||t==="")throw new Error(`App store. Wrong path: ${t}`);return t.split(".").reduce((e,s)=>e&&e[s]!==void 0?e[s]:void 0,n)}const g=new I;function A(){const n=g.get("user");return n&&Object.prototype.hasOwnProperty.call(n,"name")&&Object.prototype.hasOwnProperty.call(n,"surname")?n:null}function ce(n){if(!n||!Object.prototype.hasOwnProperty.call(n,"name")||!Object.prototype.hasOwnProperty.call(n,"surname"))throw new Error("User data is incorrect.");g.set("user",n)}function he(){g.set("user",void 0)}const X=["sound","picture","translation"],de={sound:!0,picture:!0,translation:!0};function S(){const n=g.get("settings");return n&&X.every(t=>Object.prototype.hasOwnProperty.call(n,t))?n:{...de}}function ue(n){if(!n||X.some(t=>!Object.prototype.hasOwnProperty.call(n,t)))throw new Error("Settings data is incorrect.");g.set("settings",n)}function me(){g.set("settings",void 0)}const G=["level","round"],_e={level:0,round:-1,level_completed:"",round_completed:""};function ge(){const n=g.get("progress");return n&&G.every(t=>Object.prototype.hasOwnProperty.call(n,t))?n:{..._e}}function pe(n){if(!n||G.some(t=>!Object.prototype.hasOwnProperty.call(n,t)))throw new Error("Progress data is incorrect.");g.set("progress",n)}function fe(){g.set("progress",void 0)}const ve="./assets/login.svg",we="./assets/logout.svg";function be({name:n,surname:t}){return`${(n??"").charAt(0)}${(t??"").charAt(0)}`}function Ce(){he(),me(),fe(),M(),_.go("/")}const M=()=>{const n=A(),t=document.getElementById("user")??r("div",{className:"user__menu",id:"user"});t.onclick=n?Ce:()=>_.go("/login"),t.innerHTML="";const e=r("img",{className:n?"user__menu_icon opaque":"user__menu_icon",src:n?we:ve});return t.append(e),n&&t.append(be(n)),t};class ye{constructor(){a(this,"_game",{level:0,page:0,line:0,skipped:[],fullfilled:!1,passed:!1,rounds:0,image:""});a(this,"_sentence",[]);a(this,"_items",[]);a(this,"elements",{levelSelect:null,pageSelect:null,puzzleBody:null,imageInfo:null,sourceText:null,sourceBlock:null,autoComplete:null});a(this,"rows",[]);a(this,"marks",[])}get game(){return this._game}get sentence(){return this._sentence}get items(){return this._items}set items(t){this._items=t}get levelSelect(){if(!this.elements.levelSelect)throw new Error("No levelSelect element");return this.elements.levelSelect}get pageSelect(){if(!this.elements.pageSelect)throw new Error("No pageSelect element");return this.elements.pageSelect}get puzzleBody(){if(!this.elements.puzzleBody)throw new Error("No puzzleBody element");return this.elements.puzzleBody}get imageInfo(){if(!this.elements.imageInfo)throw new Error("No imageInfo element");return this.elements.imageInfo}get sourceText(){if(!this.elements.sourceText)throw new Error("No sourceText element");return this.elements.sourceText}get sourceBlock(){if(!this.elements.sourceBlock)throw new Error("No sourceBlock element");return this.elements.sourceBlock}get autoComplete(){if(!this.elements.autoComplete)throw new Error("No autoComplete element");return this.elements.autoComplete}}const ze="_speech__btn_1oie2_1",Le="_speech__btn_icon_1oie2_19",ke="_speech__btn_active_1oie2_27",Ne="_spin_1oie2_1",O={speech__btn:ze,speech__btn_icon:Le,speech__btn_active:ke,spin:Ne},xe="./assets/sound.svg",Ee="./assets/loading.svg";class Z{constructor(t){a(this,"_el");a(this,"_status");a(this,"_audio",null);a(this,"clickHandler",()=>{this._audio&&this._audio.play()});a(this,"getSpeechButton",()=>{const t=r("div",{className:O.speech__btn,onClick:this.clickHandler}),e=r("img",{className:`${O.speech__btn_active} hidden`,src:Ee}),s=r("img",{className:O.speech__btn_icon,src:xe});return t.append(e,s),[t,e]});const[e,s]=this.getSpeechButton();this._el=e,this._status=s,t&&(this.audio=t)}get el(){return this._el}set audio(t){this._audio=new Audio(t),this._audio.addEventListener("play",()=>{this._status.classList.remove("hidden")}),this._audio.addEventListener("ended",()=>{this._status.classList.add("hidden")})}}const C=new Z;class Se extends ye{constructor(){super(...arguments);a(this,"_settings",{picture:!0,sound:!0,translation:!0});a(this,"_progress",{level:0,round:-1,level_completed:"",round_completed:""})}get opt(){return this._settings}get progress(){return this._progress}roundCompleted(e){return this._progress.round_completed.split(",").filter(s=>Number(s.charAt(0))===e).map(s=>Number(s.split("_")[1]))}levelCompleted(){return this._progress.level_completed.split(",").filter(e=>e!=="").map(e=>Number(e))}refreshSettings(){this._settings=S(),this._progress=ge()}setSetting(e,s){switch(this._settings[e]=s,e){case"translation":{try{this.sourceText.classList.toggle("hidden",!s)}catch{}break}case"sound":{C.el.classList.toggle("hidden",!s);break}case"picture":{w(":root").style.setProperty("--puzzle-hint-img",s?`url(${this.game.image})`:"unset");break}default:return}}setProgress(e,s){this._progress.level=e,this._progress.round=s;const o=`${e}_${s}`,i=this._progress.round_completed.split(",");i.includes(o)||(i.push(o),this._progress.round_completed=i.join(",")),pe(this._progress)}}function Y(n){const t=w(".puzzle__body").getBoundingClientRect(),{width:e,height:s,top:o,left:i}=n.getBoundingClientRect(),l=n.firstElementChild,h=n.lastElementChild;n.style.width=`${e.toFixed(2)}px`,n.style.height=`${s.toFixed(2)}px`,l.style.backgroundPosition=`-${i-t.left}px -${o-t.top}px`,h.style.backgroundPosition=`-${i-t.left+e-8.5}px -${o-t.top+16}px`,n.classList.remove("grow"),n.classList.add("opaque")}class $e{constructor(t){a(this,"textContent");a(this,"_el");this.textContent=t,this._el=this.create()}get el(){return this._el}create(){const t=r("div",{className:"puzzle__item grow",draggable:!0}),e=r("div",{}),s=r("div",{});t.append(e,this.textContent,s);const o=new MutationObserver(()=>{document.contains(t)&&(Y(t),o.disconnect())});return o.observe(document,{attributes:!1,childList:!0,characterData:!1,subtree:!0}),t}}class Be{constructor(){a(this,"_el");a(this,"_state","check");this._el=this.init()}get el(){return this._el}get state(){return this._state}set state(t){t==="hidden"&&this._el.classList.add("hidden"),t==="check"&&(this._el.textContent="Check",this._el.classList.remove("hidden","ready","fail")),t==="ready"&&(this._el.textContent="Continue",this._el.classList.remove("hidden","fail"),this._el.classList.add("ready")),t==="fail"&&(this._el.classList.remove("hidden","ready"),this._el.classList.add("fail"))}init(){return r("div",{className:"puzzle__source_btn hidden",textContent:"Check"})}}const f=new Be;class Pe{constructor(){a(this,"_el");a(this,"_state","hidden");this._el=this.init()}get el(){return this._el}get state(){return this._state}set state(t){t==="hidden"&&this._el.classList.add("hidden"),t==="ready"&&(this._el.classList.remove("hidden"),this._el.classList.add("results"))}init(){return r("div",{className:"puzzle__source_btn hidden",textContent:"Results"})}}const $=new Pe;class Oe extends Se{setOptions(t,e,s=0){t.innerHTML="",e.forEach((o,i)=>{const l=new Option(`${(i+1).toString()}${o?" ✔":""}`,i.toString(),!1,s===i);l.className=`puzzle__select_option${o?" done":""}`,t.append(l)})}setRow(t,e){const s=e.split(" ");this.rows[t].innerHTML="",s.forEach((o,i)=>{const l=new $e(o).el;i===0?l.classList.add("first"):i===s.length-1?l.classList.add("last"):l.classList.add("mid"),this.rows[t].append(l)})}drawField(){const t=r("div",{className:"puzzle"});return t.append(this.createSelectors(),this.createPuzzleBody(),this.createImageInfo(),this.createSourceBlock()),t}createSelectors(){const t=r("label",{className:"puzzle__level_label",textContent:"Level "});this.elements.levelSelect=r("select",{className:"puzzle__level",name:"level"}),t.appendChild(this.elements.levelSelect);const e=r("label",{className:"puzzle__page_label",textContent:"Page "});this.elements.pageSelect=r("select",{className:"puzzle__page",name:"page"}),e.appendChild(this.elements.pageSelect);const s=r("div",{className:"puzzle__select"});return s.append(t,e),s}createPuzzleBody(){this.elements.puzzleBody=r("div",{className:"puzzle__body"});for(let t=1;t<=10;t+=1){const e=r("div",{className:`puzzle__row row_${t}`});this.rows[t]=e;const s=r("div",{className:"puzzle__row_mark",textContent:t.toString()});this.marks[t]=s,this.elements.puzzleBody.append(s,e)}return this.elements.puzzleBody}createImageInfo(){return this.elements.imageInfo=r("div",{className:"puzzle__image_info hidden"}),this.elements.imageInfo}createSourceBlock(){const t=r("div",{className:"puzzle__source_container"}),e=r("div",{className:"puzzle__hints"});this.elements.sourceText=r("p",{className:"puzzle__source_text"}),e.append(C.el,this.sourceText),this.elements.sourceBlock=r("div",{className:"puzzle__source"}),this.elements.autoComplete=r("div",{className:"puzzle__source_auto",textContent:"Auto-Complete"});const s=r("div",{});return s.append(f.el,$.el),t.append(e,this.sourceBlock,this.autoComplete,s),t}}class Re{constructor(){a(this,"round",[])}}const Te=n=>`./data/wordCollectionLevel${n+1}.json`;class De extends Re{constructor(){super(...arguments);a(this,"_state",{level:0,page:0})}get(){const{level:e,page:s}=this._state;return new Promise(o=>{if(this.round[e]){const i=this.round[e].length;if(s>=i){o(this.round[e][i-1]);return}o(this.round[e][s])}else fetch(Te(e),{method:"GET",headers:{Accept:"application/json"}}).then(i=>i.json()).then(i=>{if(i&&Object.prototype.hasOwnProperty.call(i,"rounds")){const{rounds:h}=i;this.round[e]=h,console.log(`Imported: Data (${i.rounds.length}) for level`,e+1)}const l=this.round[e].length;if(s>=l){o(this.round[e][l-1]);return}o(this.round[e][s])})})}change({level:e,page:s},o){e!==void 0&&e!=this._state.level&&(s=0),this._state={level:e!==void 0?e:this._state.level,page:s!==void 0?s:this._state.page},this.get().then(()=>{o&&o.forEach(i=>i())})}}const p=new De;function Ie(n){const t=Array.from(n);let e=t.length,s=0;for(;e>0;)s=Math.floor(Math.random()*e),e-=1,[t[e],t[s]]=[t[s],t[e]];return t}const He="_modal__wrapper_1vl4r_1",Ae="_reveal_1vl4r_1",Me="_modal__outer_1vl4r_26",Fe="_modal__inner_1vl4r_38",je="_modal__close_1vl4r_45",y={modal__wrapper:He,reveal:Ae,modal__outer:Me,modal__inner:Fe,modal__close:je},qe="./assets/close.svg";class Ue{constructor(){a(this,"_el");a(this,"_inner");a(this,"close",()=>{this._el.classList.add("hidden")});a(this,"handleClick",t=>{const{target:e,currentTarget:s}=t;e===s&&(t.preventDefault(),this.close())});a(this,"init",()=>{const t=r("div",{className:`${y.modal__wrapper} hidden`,onClick:this.handleClick}),e=r("div",{className:y.modal__outer}),s=r("div",{className:y.modal__close,onClick:this.close}),o=r("img",{src:qe});s.append(o);const i=r("div",{className:y.modal__inner});return e.append(s,i),t.append(e),{modal:t,inner:i}});const{modal:t,inner:e}=this.init();this._el=t,this._inner=e}get el(){return this._el}show(t){this._el.classList.remove("hidden"),this._inner.innerHTML="",this._inner.append(t)}}const H=new Ue,q=(n,t)=>{const e=document.createDocumentFragment(),s=r("p",{className:"results__words_title",textContent:n}),o=r("ul",{className:"results__words_list"});return o.append(...t.map(i=>{const l=r("li",{className:"results__words_item"});return l.append(new Z(i.sound).el,i.sentence),l})),e.append(s,o),e},We=({level:n,round:t,src:e,name:s,year:o,words:i,skipped:l,onClick:h})=>{const c=document.createDocumentFragment(),u=r("h2",{className:"results__title",textContent:"Page completed!"}),B=r("p",{className:"results__level",textContent:`Level: ${n+1}. Page: ${t+1}.`}),d=r("img",{className:"results__thumb",src:e,alt:"thumbnail"}),b=r("p",{className:"results__descr",textContent:`${s} (${o})`}),F=r("div",{className:"results__words scrolled"}),j=i.filter((ne,P)=>!l.includes(P));F.append(q(`Solution used (${l.length}):`,i.filter((ne,P)=>l.includes(P))),q(`Solved (${j.length}):`,j));const se=r("button",{className:"button",textContent:"Continue",onClick:()=>{h(),H.close()}});c.append(u,B,d,b,F,se),H.show(c)},U={drop:"./assets/drop.mp3",match:"./assets/match.ogg"};class Qe{constructor(){a(this,"_audio");this._audio=K(U).reduce((t,e)=>(t[e]=new Audio(U[e]),t),{})}play(t){var e;(e=this._audio[t])==null||e.play()}}const R=new Qe,z="https://raw.githubusercontent.com/rolling-scopes-school/rss-puzzle-data/main/";class Ve extends Oe{constructor(){super();a(this,"_drag",{item:null,over:null});a(this,"_field",{size:0});a(this,"isInitialized",!1);a(this,"levelChangeCallback",()=>{const e=p.round[this.game.level].length;this.game.rounds=e;const s=this.roundCompleted(this.game.level),o=Array.from({length:e},(h,c)=>s.includes(c));this.setOptions(this.pageSelect,o,this.game.page);const i=this.levelCompleted(),l=Array.from({length:6},(h,c)=>i.includes(c));this.setOptions(this.levelSelect,l,this.game.level)});a(this,"lineChangeCallback",()=>setTimeout(()=>this.setSource(this.game.line),100));a(this,"showResults",()=>{p.get().then(e=>{We({level:this.game.level,round:this.game.page,src:`${z}images/${e.levelData.imageSrc}`,name:e.levelData.name,year:e.levelData.year,words:e.words.map(s=>({sentence:s.textExample,sound:`${z}${s.audioExample}`})),skipped:this.game.skipped,onClick:this.continueHandler.bind(this)})})});a(this,"continueHandler",()=>{if(this.game.passed){if(this.lineComplete(),this.game.passed=!1,this.game.line+=1,this.game.line<=10){this.setSource(this.game.line);return}this.nextRound()}else{const e=this.sentenceCheck();f.state=e?"ready":"fail",e&&(this.sourceText.classList.remove("hidden"),C.el.classList.remove("hidden"),this.game.line===10&&this.pageComplete())}});a(this,"resizeHandler",()=>{var s;if(((s=_.getRoute())==null?void 0:s.pathname)!=="/game")return;const e=Math.floor(this.puzzleBody.getBoundingClientRect().width);if(e!==this._field.size){this._field.size=e;const o=w(":root"),{width:i,height:l}=this.puzzleBody.getBoundingClientRect();o.style.setProperty("--puzzle-size",`${i}px ${l}px`);const{height:h}=this.rows[1].getBoundingClientRect();this.rows.forEach((c,u)=>c.style.backgroundPosition=`0px -${h*(u-1)}px`),this.items.forEach(c=>{this.rows[this.game.line].appendChild(c)});for(let c=1;c<11;c+=1){const u=this.rows[c].children;Array.from({length:u.length},(d,b)=>u[b]).forEach(d=>{d.removeAttribute("style"),d.classList.add("grow"),d.classList.add("opaque")})}for(let c=1;c<11;c+=1){const u=this.rows[c].children;Array.from({length:u.length},(d,b)=>u[b]).forEach(d=>{Y(d),c<=this.game.line&&d.classList.remove("opaque")})}this.items.forEach(c=>{this.sourceBlock.appendChild(c)})}});this.baseChangeCallback=this.baseChangeCallback.bind(this)}baseChangeCallback(){this.game.line=1,this.game.skipped=[],this.game.passed=!1,f.state="hidden",$.state="hidden";const e=w(":root");p.get().then(s=>{this.game.image=`${z}images/${s.levelData.imageSrc}`,e.style.setProperty("--puzzle-img",`url(${this.game.image})`),this.opt.picture&&e.style.setProperty("--puzzle-hint-img",`url(${this.game.image})`);const{width:o,height:i}=this.puzzleBody.getBoundingClientRect();e.style.setProperty("--puzzle-size",`${o}px ${i}px`);const{height:l}=this.rows[1].getBoundingClientRect();this.rows.forEach((h,c)=>{h.classList.remove("complete"),h.style.backgroundPosition=`0px -${l*(c-1)}px`}),this.marks.forEach(h=>h.classList.remove("complete")),this.imageInfo.textContent=`${s.levelData.name} (${s.levelData.year})`,this.imageInfo.classList.add("hidden"),s.words.forEach((h,c)=>{this.setRow(c+1,h.textExample),this.sentence[c]=h.textExample})})}nextRound(){this.setProgress(this.game.level,this.game.page),this.game.page+=1;const e=[this.baseChangeCallback,this.levelChangeCallback,this.lineChangeCallback];if(this.game.page>=this.game.rounds){this.game.page=0,this.game.level+=1,this.game.level>5&&(this.game.level=0),p.change({level:this.game.level},e);return}p.change({page:this.game.page},e)}changeHandler(e){const s=e.target,o=s.name,i=Number(s.value),l=[this.baseChangeCallback,this.lineChangeCallback];(o==="level"||o==="page")&&(this.game[o]=i),o==="level"&&(this.game.page=0,l.push(this.levelChangeCallback)),p.change({[o]:i},l)}lineComplete(){Array.from(this.rows[this.game.line].children).forEach(e=>e.classList.remove("active")),this.removeDragReceiveListeners(this.rows[this.game.line]),this.rows[this.game.line].classList.add("complete"),this.marks[this.game.line].classList.add("complete")}pageComplete(){this.imageInfo.classList.remove("hidden"),this.lineComplete(),$.state="ready"}sentenceCheck(){const s=Array.from(this.rows[this.game.line].children).reduce((o,i)=>`${o} ${i.textContent}`,"").trim();return this.game.passed=this.sentence[this.game.line-1]===s,this.game.passed&&this.opt.sound&&R.play("match"),this.game.passed}checkSource(){this.sourceBlock.children.length?this.game.fullfilled&&(this.game.fullfilled=!1,this.sourceBlock.classList.remove("hidden"),this.autoComplete.classList.remove("hidden"),f.state="hidden",this.game.passed=!1):(this.game.fullfilled=!0,this.sourceBlock.classList.add("hidden"),this.autoComplete.classList.add("hidden"),f.state="check")}setSource(e){p.get().then(i=>{this.sourceText.textContent=i.words[e-1].textExampleTranslate,this.sourceText.classList.toggle("hidden",!this.opt.translation),C.audio=`${z}${i.words[e-1].audioExample}`}),C.el.classList.toggle("hidden",!this.opt.sound),this.sourceBlock.classList.remove("hidden"),this.autoComplete.classList.remove("hidden"),f.state="hidden";const s=i=>{const l=i.currentTarget;l.dataset.placed?(this.sourceBlock.appendChild(l),delete l.dataset.placed):(this.rows[e].appendChild(l),l.dataset.placed="true"),this.opt.sound&&R.play("drop"),this.checkSource()};this.setDragReceiveListeners(this.rows[e]),this.sourceBlock.innerHTML="",this.items=Array.from({length:this.rows[e].children.length},(i,l)=>this.rows[e].children[l]),Ie(this.items).forEach(i=>{this.sourceBlock.appendChild(i),i.classList.remove("opaque"),i.classList.add("active"),i.addEventListener("click",s),i.addEventListener("dragstart",this.dragStart.bind(this)),i.addEventListener("dragend",this.dragEnd.bind(this)),i.addEventListener("dragover",this.dragOverItem.bind(this))})}autoCompleteHandler(){Array.from(this.rows[this.game.line].children).forEach(e=>{this.sourceBlock.appendChild(e),delete e.dataset.placed}),this.items.forEach(e=>{this.rows[this.game.line].appendChild(e),e.dataset.placed="true"}),this.game.skipped.push(this.game.line-1),this.checkSource()}dragStart(e){const s=e.target;s.classList.add("drag"),this._drag.item=s}dragEnd(e){e.target.classList.remove("drag"),this._drag.item=null}dragEnter(e){e.preventDefault(),e.currentTarget.classList.add("highlight")}dragOver(e){e.preventDefault()}dragOverItem(e){e.preventDefault();const s=e.currentTarget;if(s!==this._drag.over){this._drag.over&&(this._drag.over.style.borderLeft="",this._drag.over.style.borderRight=""),this._drag.over=s;const o=s.getBoundingClientRect(),i=o.x+o.width/2;e.clientX-i>0?(s.style.borderRight="solid 2em transparent",s.style.borderLeft=""):(s.style.borderLeft="solid 2em transparent",s.style.borderRight="")}}dropCard(e){const s=e.currentTarget;s.classList.remove("highlight"),this._drag.item&&this._drag.over&&this._drag.over.parentElement===s?e.clientX>this._drag.over.getBoundingClientRect().left+this._drag.over.offsetWidth/2?s.insertBefore(this._drag.item,this._drag.over.nextSibling):s.insertBefore(this._drag.item,this._drag.over):this._drag.item&&(s.append(this._drag.item),s!==this.sourceBlock&&(this._drag.item.dataset.placed="true")),this._drag.over&&(this._drag.over.style.borderLeft="",this._drag.over.style.borderRight=""),this.opt.sound&&R.play("drop"),this.checkSource()}setDragReceiveListeners(e){e.addEventListener("dragenter",this.dragEnter.bind(this)),e.addEventListener("dragover",this.dragOver.bind(this)),e.addEventListener("drop",this.dropCard.bind(this))}removeDragReceiveListeners(e){e.removeEventListener("dragenter",this.dragEnter),e.removeEventListener("dragover",this.dragOver),e.removeEventListener("drop",this.dropCard)}init(){this.refreshSettings();const e=this.drawField();return this.game.level=this.progress.level,this.game.page=this.progress.round+1,p.change({level:this.game.level,page:this.game.page},[this.baseChangeCallback,this.levelChangeCallback,this.lineChangeCallback]),this.levelSelect.addEventListener("change",this.changeHandler.bind(this)),this.pageSelect.addEventListener("change",this.changeHandler.bind(this)),this.autoComplete.addEventListener("click",this.autoCompleteHandler.bind(this)),this.setDragReceiveListeners(this.sourceBlock),this.isInitialized||(window.addEventListener("resize",this.resizeHandler),f.el.addEventListener("click",this.continueHandler),$.el.addEventListener("click",this.showResults),this.isInitialized=!0),e}}const ee=new Ve,Je={picture:"./assets/picture.svg",sound:"./assets/sound.svg",translation:"./assets/translation.svg"},W=["sound","picture","translation"];class Ke{constructor(){a(this,"_el");a(this,"_options",{sound:null,picture:null,translation:null});a(this,"switchHandler",t=>{const e=t.currentTarget;if(e){const s=!e.classList.contains("active");e.classList.toggle("active",s);const o=e.dataset.option;if(o){const i=S();ue({...i,[o]:s}),ee.setSetting(o,s)}}});a(this,"getSettingsMenu",()=>{const t=S(),e=r("ul",{className:"settings"});return W.forEach(s=>{const o=t[s]?" active":"",i=r("li",{className:`settings__item${o}`,onClick:this.switchHandler.bind(this)});i.dataset.option=s;const l=r("img",{className:"settings__icon",src:Je[s]});i.append(l),this._options[s]=i,e.append(i)}),e});this._el=this.getSettingsMenu()}get el(){return this._el}refresh(){const t=S();W.forEach(e=>{var s;(s=this._options[e])==null||s.classList.toggle("active",t[e])}),this._el.classList.remove("hidden")}}const te=new Ke,Xe="_header__logo_2c5ki_1",Ge="_header__logo_img_2c5ki_13",Ze="_header__title_2c5ki_18",Ye="_header__menu_2c5ki_22",L={header__logo:Xe,header__logo_img:Ge,header__title:Ze,header__menu:Ye},Q="./assets/favicon.png",et=()=>{const n=r("header",{className:"header"}),t=r("div",{className:L.header__menu});t.append(te.el,M());const e=r("div",{className:L.header__logo,src:Q,onClick:()=>_.go("/")});return e.append(r("img",{className:L.header__logo_img,src:Q,alt:"logo"}),r("h1",{className:L.header__title,textContent:"Puzzle"})),n.append(e,t),n},tt=()=>r("main",{className:"main"}),st=()=>{const n=r("footer",{className:"footer"}),t=r("div",{className:"footer__author"}),e=r("span",{textContent:"© 2024"}),s=r("img",{className:"footer__author_avatar",src:"./assets/ranjy_hex.png"}),o=r("a",{textContent:"mrHoft",href:"https://github.com/mrHoft"});t.append(e,s,o);const i=r("a",{className:"footer__rss_logo",href:"https://rs.school/"});return n.append(t,i),n},nt="_form__input_container_wlcbr_1",it="_form__input_wlcbr_1",ot="_form__input_valid_wlcbr_27",rt="_form__input_label_wlcbr_39",k={form__input_container:nt,form__input:it,form__input_valid:ot,form__input_label:rt},V=({name:n,type:t="text",placeholder:e="",...s})=>{const o=r("div",{className:k.form__input_container}),i=r("input",{name:n,className:k.form__input,id:`form_${n}`,type:t,placeholder:"",minLength:3,maxLength:16,required:!0,autocomplete:"off",...s}),l=r("label",{className:k.form__input_label,textContent:e,htmlFor:`form_${n}`}),h=r("span",{className:k.form__input_valid,textContent:"✔"});return o.append(i,l,h),o},at="_form__submit_1beo6_1",lt={form__submit:at},ct=({children:n,disabled:t})=>r("button",{className:lt.form__submit,type:"submit",disabled:t,textContent:n}),ht="_login_e5htv_1",dt="_login__form_e5htv_14",T={login:ht,login__form:dt},ut=n=>{var e,s;const t=n.currentTarget;if(t){const o=new FormData(t),i={name:((e=o.get("name"))==null?void 0:e.toString())||"",surname:((s=o.get("surname"))==null?void 0:s.toString())||""};ce(i),n.preventDefault(),_.go("/")}},J="latin letters and the hyphen ('-') symbol. First letter must be uppercase.",mt=()=>{const n=document.createDocumentFragment(),t=r("h1",{className:T.login__header,textContent:"Please enter your name"}),e=r("form",{className:T.login__form});e.addEventListener("submit",ut);const s="^[A-Z][a-z\\-]+",o=V({name:"name",placeholder:"first name",minLength:"3",pattern:s,title:`3-16 ${J}`}),i=V({name:"surname",placeholder:"surname",minLength:"4",pattern:s,title:`4-16 ${J}`}),l=ct({children:"Login"});e.append(o,i,l),n.append(t,e);const h=r("section",{className:T.login});return h.append(n),h},_t="_welcome_1ri9j_1",gt="_welcome__title_1ri9j_14",pt="_welcome__user_1ri9j_19",ft="_welcome__descr_list_1ri9j_23",N={welcome:_t,welcome__title:gt,welcome__user:pt,welcome__descr_list:ft},vt=["Click on words, collect phrases.","Words can be drag and drop.","Use menu icons to switch tooltips."],wt=()=>{const n=A(),t=r("section",{className:N.welcome});t.append(r("h1",{className:N.welcome__title,textContent:"English puzzle game"})),n&&t.append(r("p",{className:N.welcome__user,textContent:`Welcome ${n.name} ${n.surname}!`}));const e=r("ul",{className:N.welcome__descr_list});return e.append(...vt.map(s=>r("li",{textContent:s}))),t.append(e,r("button",{className:"button",textContent:"Start",onClick:()=>_.go("/game")})),t};function bt(){const n=document.createDocumentFragment();return n.append(r("h1",{textContent:"(404) Page not found!"}),r("button",{className:"button",textContent:"← Home",onClick:()=>_.go("/")})),n}const x=n=>{const t=w("main");t.innerHTML="",t.append(n)},E={404:()=>{x(bt())},login:()=>{x(mt())},home:()=>{const n=A(),t=w(".settings");if(!n){t.classList.add("hidden"),_.go("/login");return}te.refresh(),x(wt()),M()},game:()=>{x(ee.init())}},Ct=()=>{_.use("/",E.home).use("/login",E.login).use("/game",E.game).use("/404",E[404]).start()},yt=()=>{const n=document.createDocumentFragment();return n.append(et(),tt(),st(),r("div",{className:"body__bg"}),H.el),n};document.body.prepend(yt());Ct();
